---
title: "Assignment 1-Apartment Building Inspections in Toronto, Ontario"
author: 'Prepared by: Hidayatullah Hidaning Buwono'
date: 'Student ID: U62812001'
output: 
  html_document: 
    highlight: espresso
---
============================================================================================================

```{r}
library(tidyverse)
library(naniar)
```


### **Question No. 1**
Download the file ‘apartments_toronto.csv’ from our class Blackboard site. This dataset contains information about apartment building inspections conducted in the city of Toronto, Ontario.

### Answer:
The dataset has been stored in the local directory, and information regarding the dataset's description has been obtained from the link provided.


### **Question No. 2**
Read this file into your R environment (if it takes a while for the file to load, don’t worry -- this is normal. Be patient). Be sure to use the read.csv() function to import this dataset.

a. Call the str() function on your dataset, and show the results.
b. What does this function accomplish? How many rows and how many columns does your dataframe contain?

### Answer:
Having used `read.csv()` function, the 'apartments_toronto.csv' can be loaded into the environment and assigned into 'apt'.
```{r}
apt <- read.csv("/Users/hidayatullahhidaningbuwono/Documents/BU/Spring 2023/Data Mining/Assignment/apartments_toronto.csv")
```

a. Utilizing `str()` function to 'apt' data frame
```{r}
str(apt)
```

b. The `str()` function deciphering the internal structure of the 'apt' data frame, including what variables are inside the data frame and what data types of each variable. Based on the output from this function, the 'apt' data frame consists of 11,651 rows and 40 columns.


### **Question No. 3**
Filter your dataset, so that it only contains records with your assigned ward (a list of all ward name assignments can be found on Blackboard).

a. How many records does your dataframe contain now?

### Answer:
According to the assigned ward, the appointed ward for this project is "Don Valley East". Which after using the `filter()` function, the data is assigned to 'hida'. 
```{r}
hida <- filter(apt,WARDNAME=="Don Valley East")
str(hida)
```


a. Using the `str()` function, the data frame rows and columns after the filtering process becomes 505 rows and 40 columns.


### **Question No. 4**
Dealing with NA data.

a. Are there any NA values in your dataframe? How do you know this? What is the
total number of NAs in the dataframe?

b. Generate a table that shows the number of missing values and the percentage of
missing values for each variable. Which variables have missing values? Pick any three columns with missing values – in a sentence or two for each one, explain why the column might have missing values. (Note: There is no domain knowledge needed to answer this question – any thoughtful explanation here is
fine). Remember to consult the dataset description. You may wish to use a function from the naniar package for this step, but you are not required to.

c. For any column(s) whose values are more than 50% missing, remove the column(s) entirely.

### Answer:
a. In order to find out if there are any NA values in my data frame i.e., "hida" the `anyNA()` function will be utilized, and `n_miss()` function from naniar package will be used to tell the number of missing values as follows:
```{r}
library(naniar)
anyNA(hida)
n_miss(hida)
```

From the result above, the data frame has missing values, and the total of missing values in the entire data frame is 1,054 NAs.

b. The `mis_var_summary()` function is used to present the missing values in a table format as follows:
```{r}
library(naniar)
library(DT)
datatable(miss_var_summary(hida))
```

Based on the table above, there are 13 variables that have missing values: OTHER_FACILITIES, STORAGE_AREAS_LOCKERS, GARBAGE_CHUTE_ROOMS, YEAR_EVALUATED, ELEVATORS, X, Y, BALCONY_GUARDS, LAUNDRY_ROOMS, PARKING_AREA, LATITUDE, LONGITUDE, and YEAR_REGISTERED.

Picking 3 out of 13 variables that have missing values, the possible reason why the data has missing values can be explained below:

- STORAGE_AREAS_LOCKERS has missing values because the apartment probably does not have that facility, in this case, the storage area.

- ELEVATORS has missing values because the apartment probably does not have an elevator.

- LAUNDRY_ROOMS has missing values because the apartment probably does not provide a laundry room.


c. According to the table on point b above, the OTHER_FACILITIES variable has 76.63% missing values. Thus, it needs to be removed from the data frame.
```{r}
hida_clean <- subset(hida, select=-OTHER_FACILITIES)
```

Having used `subset()` function, the OTHER_FACILITIES variable has been removed.


### **Question No. 5**
Handling dates

a. Which column in this dataset contains dates? Run the str() function to see how
R views this variable. What data type is it seen as?

b. Using any method, convert this variable to a ‘Date’ data type, and show that its
type has been successfully converted. (Note: Be careful to pay attention to the particular way the date is written – if you don’t, this will not come out the way you want it to).

c. What is your birth month? (just answer here with the month – you won’t use the day or year).

    i. How many Toronto building inspections in your ward were made during your birth month?


### Answer:

a. Using the `str()` function on the "hida_clean" data frame shows that the EVALUATION_COMPLETED_ON column contains dates. However, the data type for that column is character.
```{r}
str(hida_clean)
```

b. Using the `as.Date()` function and selecting the correct date format, the EVALUATION_COMPLETED_ON's data type has been converted to a 'date' data type. To check the data type, the `class()` function is utilized. 
```{r}
library(lubridate)
hida_clean$EVALUATION_COMPLETED_ON <- as.Date(hida_clean$EVALUATION_COMPLETED_ON, format="%Y-%m-%d")
class(hida_clean$EVALUATION_COMPLETED_ON)
```


c. My birth month is October.
```{r}
library(lubridate)
Q5_c <- hida_clean %>% mutate(Month=format(as.Date(hida_clean$EVALUATION_COMPLETED_ON, format="%d/%m/%Y"),"%B"))
Q5_c_Oct <- filter(Q5_c, Month=="October") 
dim(Q5_c_Oct)
```
The first step, adding the Month column using the `mutate()` function and assigned to the "Q5_c" data frame. After that, the "Q5_c" is filtered for building inspections that were held in October. Using the `dim()` function, there are 131 building inspections that were held in October. 

### **Question No. 6**
Exploring the dataset

a. Should “Ward” be considered a numeric or categorical variable? Why? 

b. Average storeys

    1. What is the median number of confirmed storeys for the buildings in your ward?
    2. What is the mean number of confirmed storeys for the buildings in your ward?
    3. Write a sentence or two that could help to explain the difference (or similarity) between the two average storey values that you just found. What might explain this?
    
c. What percentage of all the buildings in your ward received a result of “Evaluation needs to be conducted in 3 years”?

d. What is the oldest building in your ward? What overall evaluation score did it earn? (Note: If several buildings are tied for ‘oldest’ because they were built in the same year, you can pick any of the ones from that year to answer this)

### Answer:
a. Based on the dataset description, the Ward column consists of 25 ward systems, which determines based on where the building is located. Thus the ward column is considered as a categorical variable.

b. Average Storeys
```{r}
library(ggplot2)
summary(hida_clean$CONFIRMED_STOREYS)
ggplot(hida_clean, aes(x=CONFIRMED_STOREYS)) +geom_bar(fill="turquoise2", color="black")+scale_x_continuous(breaks=seq(1,28,1))

```


1. Based on the `summary()` function, the median storeys of my Ward data is 5 storeys.
2. Based on the `summary()` function, the mean storeys of my Ward data is 7.88 storeys.
3. Having visualized the data of the "CONFIRMED_STOREYS" variable, the difference between the median and mean of that data is because the distribution is positively skewed or right-skewed. Where there are some "outliers" in the population, so that makes the mean bigger than the median.

c. The percentage of buildings that needs to be evaluated in 3 years is 20.39%. This number is derived from 103 divided by the total apartment in my ward which is 505 buildings. The code as follows:
```{r}
Q6_c <- filter(hida_clean, RESULTS_OF_SCORE=="Evaluation needs to be conducted in 3 years")
dim(Q6_c)
```

d. Using the `min()` function, the oldest building in my ward was built in 1950. Afterward, utilizing the `filter()` function for the buildings which was built in 1950, and subsetting one building in that data frame, we managed to take the overall evaluation score(in column no. 13) for data in the first row which is 76.
```{r}
min(hida_clean$YEAR_BUILT)
Q6_d <- filter(hida_clean, YEAR_BUILT==1950)
Q6_d[1,13]
```


### **Question No. 7**
Using the quarter() function from lubridate, create a new column called season. Season should be created from the Evaluation_Completed_On variable. Next, rename the quarters so that Quarter 1 becomes “Winter”, Quarter 2 becomes “Spring”, Quarter 3 becomes “Summer” and Quarter 4 becomes “Fall.”

### Answer:
Having used the `quarter()` function with the underlying data of the "EVALUATION_COMPLETED_ON" variable, the data frame has a new variable called "SEASON". Then, the "SEASON" data are changed using the following code:
```{r}
library(lubridate)
hida_clean$SEASON <- quarter(hida_clean$EVALUATION_COMPLETED_ON,"quarter", fiscal_start = 1)

hida_clean$SEASON[hida_clean$SEASON==1] <- "Winter"
hida_clean$SEASON[hida_clean$SEASON==2] <- "Spring"
hida_clean$SEASON[hida_clean$SEASON==3] <- "Summer"
hida_clean$SEASON[hida_clean$SEASON==4] <- "Fall"

head(hida_clean$SEASON)
```


### **Question No. 8**
Using ggplot, construct a barplot showing the counts of completed evaluations during each of the four seasons. Fill your bars with any color of your choice.

a. What do you notice about your plot? Why might it look the way it does? (note: there is NO need for domain knowledge here – just take a moment to think about it, and answer with any reasonable speculation on your part)

### Answer:
Using `ggplot` function, the barplot can be made using SEASON variable as follows:
```{r}
library(tidyverse)
library(ggplot2)
ggplot(hida_clean, aes(SEASON)) +geom_bar(fill="turquoise2", color="black")+
  geom_text(stat='count', aes(label=..count..), vjust=-0.3) +
  ggtitle("Total of Completed Evaluations")+
  theme(plot.title = element_text(hjust = 0.5))
```
a. Based on the barplot above, the majority of apartment evaluations happened in the Fall season. This might happen because the property owners want to provide the apartment evaluation report along with their annual reports, in which the Fall season represents the last quarter of the year.


### **Question No. 9**
Again using ggplot, let’s make another barplot. This time, place the property types on the x-axis. On the y-axis, show the mean scores for graffti ratings for each property type.

a. What does this plot show you? Write 1-2 sentences that speculate about potential reasons for the different ratings among the property types. (remember that 5 is the ‘best’, or cleanest, graffiti score)

### Answer:
Before creating the barplot, the "Q9" data frame is created to provide an aggregate mean of graffiti score. This can be achieved by using the `group_by` and `summarize` functions.
```{r}
library(ggplot2)
Q9 <- hida_clean %>% group_by(PROPERTY_TYPE) %>% 
  summarize(GRAFFITI_MEAN=mean(GRAFFITI))
ggplot(Q9, aes(PROPERTY_TYPE, GRAFFITI_MEAN)) +
  geom_bar(position = "dodge",
           stat = "identity",
           fill="turquoise2", color="black") +
  geom_text(aes(label=GRAFFITI_MEAN), vjust=1.5)+
  ggtitle("The Mean Score for Graffiti Rating")+
  theme(plot.title = element_text(hjust = 0.5))
```


a. Based on the barplot above, the social housing property type has the highest score of graffiti rating, which indicates that this area is the cleanest from graffiti. The reason for this result might be that the perpetrators of graffiti reside in Social Housing.


### **Question No. 10**
Using ggplot, make a histogram that shows the distribution of the ‘SCORE’ variable.
Use any number of bins, and stylize it with any color/fill values of your choice.

a. In a sentence or two, describe this histogram. What does it show about the scores?

### Answer:
```{r}
library(ggplot2)
ggplot(hida_clean, aes(SCORE)) + 
  geom_histogram(binwidth=5, fill="turquoise2", color="black") +
  scale_x_continuous(breaks=seq(30,100,5)) +
  ggtitle("Overall Score Distribution") +
  theme(plot.title = element_text(hjust = 0.5))

summary(hida_clean$SCORE)
```

Based on the histogram above, we can see that the distribution is negatively skewed. After checking with the `summary` function, we can make sure of the skewness because the mean is less than the median, which is 77.44 and 78, respectively.


### **Question No. 11**
Using ggplot, make a histogram that shows the distribution of the ‘GRAFFITI’ variable. 

b. In a sentence or two, describe your plot – what does it show?

### Answer:

```{r}
library(ggplot2)
ggplot(hida_clean, aes(GRAFFITI)) + 
  geom_histogram(binwidth=1, fill="turquoise2", color="black") +
  ggtitle("Graffiti Rating Distribution") +
  theme(plot.title = element_text(hjust = 0.5))

summary(hida_clean$GRAFFITI)
```

Based on the histogram above, we can see that the distribution is left-skewed. After checking with the `summary` function, we can make sure of the skewness because the mean is less than the median, which is 4.69, and 5, respectively.


### **Question No. 12**
Now, generate faceted histograms. These histograms should depict the distribution of the SCORE variable, faceted on the RESULTS_OF_SCORE variable. Fill your histograms with any color of your choice, and use whatever number of bins that you wish to use.

    i. What do you see here? In a few sentences, describe what these faceted histograms show. What connection can you make between the score values and the ‘results of score’ outcomes?
    

### Answer:
```{r}
library(ggplot2)
library(tidyverse)
ggplot(hida_clean, aes(x=SCORE)) + 
  geom_histogram(binwidth=5, fill="turquoise2", color="black") +
  facet_wrap(.~RESULTS_OF_SCORE)+
  scale_x_continuous(breaks=seq(30,100,5))

```

According to the faceted histograms above, we can conclude that if the lower score that apartment gets, meaning that a comprehensive examination of the building must be conducted promptly, and if they get a good score, then the evaluation can be conducted several years later. For instance, for those apartments that get the lowest score, then, a building audit must be conducted. Conversely, if the apartment obtains the best score, then the evaluation will be held in 3 years.


### **Question No. 13**
Okay, so it’s time for one more filter operation. Filter the dataframe so that only the five most common streets from your ward remain. You can approach this anyway that you would like to – but you may wish to first split the SITE_ADDRESS variable into separate columns to make this easier.

a. Filter your dataframe so that it only contains properties from the five most common streets in your ward.

b. Now, build a scatterplot with this newly-filtered version of your data. Place YEAR_BUILT along your x-axis. Place SCORE on your y-axis, and use different colors for each street name. What do you see here? Are there any patterns or interesting takeaways from this graph?


### Answer:

#### Step 1: Split the SITE_ADDRESS into STREET_NUMBER and STREET_NAME
```{r}
library(tidyverse)
hida_split <- hida_clean %>% separate(SITE_ADDRESS, c("STREET_NUMBER", "STREET_NAME"), sep = "^\\S*\\K\\s+")

```


#### Step 2: Looking for the common STREET_NAME in dataset using `table` function
```{r}
library(tidyverse)
common_street <- table(hida_split$STREET_NAME)
common_street <- sort(common_street, decreasing=TRUE)
common_street <- head(common_street, 5)
print(common_street)
```
Having implemented those codes above, the top 5 most common streets in my ward are VICTORIA PARK AVE, YORK MILLS RD, DON MILLS RD, LAWRENCE AVE E, and THE DONWAY E.

a. Using the `filter` function, the hida_top_5 data frame contains only the top 5 most common streets in my ward. The data observations decrease from 505 to 186 observations.
```{r}
library(tidyverse)
top_5_street <- c("VICTORIA PARK AVE", "YORK MILLS RD", "DON MILLS RD", "LAWRENCE AVE E", "THE DONWAY E")
hida_top_5 <- filter(hida_split, STREET_NAME %in% top_5_street)
```


b. Using the `ggplot` function, we can create a scatterplot between YEAR_BUILT and SCORE. Based on the scatterplot below, we can infer that there is no correlation between YEAR_BUILT and SCORE even when we scrutinize STREET_NAME level data.

```{r}
library(tidyverse)
ggplot(hida_top_5, aes(x=YEAR_BUILT, y=SCORE, color=STREET_NAME)) +
  geom_point() +
  ggtitle("Correlation between YEAR_BUILT and SCORE") +
  theme(plot.title = element_text(hjust = 0.5))

```


### **Question No. 14**
Run the following line of code. For the longitude and latitude parameters for the addCircles() function, you will need to specify that you wish to use the longitude and latitude values from your dataframe:


### Answer:
Having used the `leaflet` function, the data frame can be mapped using LONGITUDE and LATITUDE as code below:
```{r}
library(leaflet)
Q14 <- leaflet(hida_split) %>% addTiles() %>%  addCircles(lng= hida_split$LONGITUDE , lat= hida_split$LATITUDE)

print(Q14) 
```


### **Question No. 15**
Run something similar, but this time, select something of your choice after the dollar sign. If you’re not sure what to choose, try a few things out and explore to find out what they do!

### Answer:
#### Step 1: Looking for alternative providers using `names` function
```{r}
library(leaflet)
names(providers)
```

#### Step 2: Using Stamen.TonerBackground as the provider.
```{r}
library(leaflet)
Q15 <- leaflet(hida_split) %>% addTiles() %>%  addCircles(lng= hida_split$LONGITUDE , lat= hida_split$LATITUDE) %>%
addProviderTiles(providers$Stamen.TonerBackground)

print(Q15)
```
Having implemented those codes above, it adds a layer before the original map of the `leaflet` function.









